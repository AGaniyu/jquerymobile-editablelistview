/*!
* jQuery Mobile Editable Listview Plugin
* https://github.com/baig/jquerymobile-editablelistview
*
* Copyright 2014 (c) Wasif Hasan Baig
*
* Released under the MIT license
* https://github.com/baig/jquerymobile-editablelistview/blob/master/LICENSE.txt
*/
!function(t){var i=!1,e=!0;t.widget("mobile.editablelistview",t.extend({initSelector:":jqmData(role='editablelistview'), :jqmData(role='editable-listview')",options:{listTitle:"View list items",listEmptyTitle:"No items to view",buttonEditLabel:"Edit",buttonAddLabel:"Add",buttonDoneLabel:"Done",buttonAddIcon:"plus",buttonEditIcon:"edit",buttonDoneIcon:"check",collapsed:!0,enhanced:!1,collapsedIcon:"carat-r",expandedIcon:"carat-d"},_create:function(){var i=this.element,e=this.options,n=e.enhanced;t.extend(this,{_ui:null,_initialRefresh:!0}),this._ui=n?{wrapper:i.parent().parent(),header:i.parent().prev(),button:i.parent().prev().children("a.ui-btn"),content:i}:this._enhance(),this._handleExpandCollapse(e.collapsed),this._on(this._ui.header,{tap:"_onHeaderTapped"}),this._on(this._ui.button,{tap:"_onEditButtonTapped"}),this.refresh()},_enhance:function(){var t=this.element,i=this.options,e=this._$markup,n={};return this._enhanceList(t),n.wrapper=t.wrap('<div class="ui-collapsible ui-collapsible-inset ui-corner-all ui-collapsible-themed-content"></div>'),n.header=e.header(this,i),n.content=t.wrap("<div class='ui-collapsible-content ui-body-inherit'></div>"),n.button=n.header.find("a"),n.header.insertBefore(n.content.parent()),n},_onEditButtonTapped:function(t){i=!i,this._handleExpandCollapse(i?!1:!this._ui.header.hasClass("ui-collapsible-heading-collapsed")),this._updateHeader(),this._insertTextInputBox(),this._toggleSplitIcon(),this._attachDetachEventHandlers(),i||this._triggerListChange(t)},_triggerListChange:function(t){var i=this.items(),e=this.length();this._trigger("listchange",t,{items:i,length:e})},_trigerListAdd:function(){},_trigerListRemove:function(){},_onHeaderTapped:function(){this._isListEmpty()||(this._handleExpandCollapse(i?!1:!this._ui.header.hasClass("ui-collapsible-heading-collapsed")),e?this._ui.content.filter("ul").css("margin","-0.5em -1em"):i?this._ui.content.filter("ul").css("margin","-0.5em -1em"):this._ui.content.filter("ul").css("margin","-0.6em -1em"))},_attachDetachEventHandlers:function(){this._enableInsertListItemEvent(),this._enableListItemDeleteEvent(),this._enableListItemEditing()},_enableInsertListItemEvent:function(){var t=this._ui.content.find("li.ui-editable-temp a#item-add"),e=this._ui.content.find("input[type=text]");i?(this._on(t,{tap:"_insertListItem"}),this._on(e,{keyup:"_insertListItem"})):(this._off(t,"tap"),this._off(e,"keyup"))},_enableListItemDeleteEvent:function(){i?this._on(this._ui.content.find("li.ui-li-has-alt a.ui-editable-temp"),{tap:"_deleteListItem"}):this._off(this._ui.content.find("li.ui-li-has-alt a.ui-editable-temp"),"tap")},_updateHeader:function(){var t=this.options,e=this._isListEmpty(),n=this.options.collapsed;this._ui.header.find("span").text(e?t.listEmptyTitle:t.listTitle),this._ui.button.removeClass("ui-icon-"+t.buttonDoneIcon+" ui-icon-"+t.buttonAddIcon+" ui-icon-"+t.buttonEditIcon).addClass(i?"ui-icon-"+t.buttonDoneIcon:e?"ui-icon-"+t.buttonAddIcon:"ui-icon-"+t.buttonEditIcon).text(i?t.buttonDoneLabel:e?t.buttonAddLabel:t.buttonEditLabel),this._ui.header.removeClass("ui-btn-icon-left ui-icon-"+t.expandedIcon+" ui-icon-"+t.expandedIcon).addClass(i?e?"":"ui-btn-icon-left ui-icon-"+t.expandedIcon:e?"":n?"ui-btn-icon-left ui-icon-"+t.collapsedIcon:"ui-btn-icon-left ui-icon-"+t.expandedIcon)},_enableListItemEditing:function(){i?this._on(this._ui.content.find("li a.ui-btn"),{tap:"_editListItem"}):this._off(this._ui.content.find("li a.ui-btn"),"tap")},_editListItem:function(){},_insertListItem:function(i){if(i.preventDefault(),"tap"===i.type||i.keyCode===t.mobile.keyCode.ENTER){var n=t(i.target),a="keyup"===i.type?n:n.prev().find("input"),s=a.val();if(s){var l=this._attachDeleteListItemEvent(this._enhanceListItem("<li>"+s+"</li>"));a.val(""),n.parents("ul").children("li").first().css("border-bottom-width","0").after(l),this.refresh(),e=!1}}},_deleteListItem:function(i){t(i.currentTarget).parent().remove(),this._updateHeader(),i.preventDefault(),i.stopPropagation()},_insertTextInputBox:function(){var t=this._$markup,n=e?"0 0 1px 0":"0";i?this._ui.content.prepend(t.listTextInput().css("border-width",n)):this._ui.content.find("li.ui-editable-temp").remove()},_toggleSplitIcon:function(){i?this._ui.content.find("li").next().addClass("ui-li-has-alt").append('<a class="ui-editable-temp ui-btn ui-btn-icon-notext ui-icon-minus ui-btn-a"></a>'):this._ui.content.find("li").removeClass("ui-li-has-alt").find("a.ui-editable-temp").remove()},_isListEmpty:function(){return 0===this.element.find("li").not("li.ui-editable-temp").length?!0:!1},_addToolbarButton:function(i){return t('<button class="ui-btn-right ui-btn ui-btn-b ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-check">'+this.options.buttonLabel+"</button>"+i[0].outerHTML)},_enhanceList:function(i){var e=i.filter("ul"),n=e.children();e.addClass("ui-listview ui-corner-all ui-shadow"),n.each(function(){t(this).children().length?0:t(this).wrapInner('<a class="ui-btn"></a>')})},_enhanceListItem:function(i){var e=t(i);return e.wrapInner('<a class="ui-btn"></a>'),e.first().addClass("ui-li-has-alt"),e.append('<a class="ui-editable-temp ui-btn ui-btn-icon-notext ui-icon-minus ui-btn-a"></a>'),e},_attachDeleteListItemEvent:function(t){return this._on(t.find("a.ui-editable-temp"),{tap:"_deleteListItem"}),t},_handleExpandCollapse:function(t){var i=this.options,e=this._ui;e.header.toggleClass("ui-collapsible-heading-collapsed ui-corner-all",t).toggleClass("ui-editable-listview-corner",!t).css("margin-bottom","0").toggleClass("ui-icon-"+i.expandedIcon,!t).toggleClass("ui-icon-"+i.collapsedIcon,t),this.element.toggleClass("ui-collapsible-collapsed",t),e.content.parent().toggleClass("ui-collapsible-content-collapsed",t).attr("aria-hidden",t).trigger("updatelayout"),this.options.collapsed=t,this._trigger(t?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var t=this._ui,i=this.options,e=t.content.filter("ul"),n=e.find("li"),a=this.items();return i.enhanced?this:(t.header.remove(),t.content=t.content.unwrap().unwrap(),e.removeClass("ui-listview ui-corner-all ui-shadow ui-collapsible-collapsed"),e.find("a").remove(),this._removeFirstLastClasses(n),n.removeClass("ui-li-has-alt"),n.each(function(t){this.textContent=a[t]}),t)},length:function(){return this.element.find("li").length},items:function(){var t=[];return this.element.find("li").each(function(i,e){t.push(e.textContent)}),t},widget:function(){return this._ui.wrapper},refresh:function(){var t=this._ui.content,i=this.options,e=this._initialRefresh,n=t.find("li");this._updateHeader(),this._enhanceList(t),this._addFirstLastClasses(n,i.excludeInvisible?this._getVisibles(n,e):n,e),this._initialRefresh=!1},_$markup:{listTextInput:function(){return t('<li class="ui-editable-temp ui-btn" style="padding: 0.3em 0.8em;"><div class="ui-editable-flex"><div style="background-color: white; padding: 0;" class="ui-editable-flex-item-left ui-editable-border-left ui-input-text ui-btn ui-shadow-inset"><input type="text"></div><a id="item-add" style="height: auto" class="ui-editable-flex-item-right ui-editable-border-right ui-btn ui-shadow ui-btn-icon-notext ui-icon-plus">Add</a></div></li>')},header:function(i,e){var n=i._isListEmpty()?e.listEmptyTitle:e.listTitle,a=i._isListEmpty()?e.buttonAddLabel:e.buttonEditLabel,s=(i._isListEmpty()?e.buttonAddIcon:e.buttonEditIcon,function(t){return t._isListEmpty()?"":"ui-icon-"+e.collapsedIcon}(i));return t('<div role="banner" class="ui-collapsible-heading-toggle ui-btn ui-btn-inherit ui-btn-icon-left '+s+'"><div class="ui-bar ui-editable-listview-title"><span>'+n+'</span></div><a class="ui-btn ui-btn-right ui-btn-inline ui-corner-all ui-mini ui-btn-icon-right">'+a+"</a></div>")}}},t.mobile.behaviors.addFirstLastClasses))}(jQuery),$(document).bind("pagecreate",function(t){$(":jqmData(role='editablelistview'), :jqmData(role='editable-listview')",t.target).editablelistview()});
