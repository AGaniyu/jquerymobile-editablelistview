/*!
 * jQuery Mobile Editable Listview Plugin
 * https://github.com/baig/jquerymobile-editablelistview
 *
 * Copyright 2014 (c) Wasif Hasan Baig
 *
 * Released under the MIT license
 * https://github.com/baig/jquerymobile-editablelistview/blob/master/LICENSE.txt
 */
!function(e){"use strict";e.widget("mobile.listview",e.mobile.listview,{_created:!1,_origDom:null,_editMode:!1,_counter:1,_dataItemName:"item",_itemNames:[],_evt:null,_clickHandler:null,options:{editable:!1,editableType:"simple",editableForm:"",listTitle:"View list items",listEmptyTitle:"No items to view",editLabel:"Edit",addLabel:"Add",doneLabel:"Done",addIcon:"plus",editIcon:"edit",doneIcon:"check",buttonTheme:"a",buttonCorner:!0,buttonShadow:!0},_beforeListviewRefresh:function(){var t,i,n,a=this.element,l=this.options,s=this._origDom,o=this._dataItemName,d=this._counter,h=this._evt,r=a.find("li"),c=this._$markup;if(null===s&&(s=a.clone(),e.each(s.children("li"),function(t,i){e(i).attr("data-"+o,d),d++}),this._counter=d,s.removeClass("ui-listview ui-shadow ui-corner-all ui-listview-inset ui-group-theme-"+this.options.theme).find("li").removeClass("ui-li-static ui-body-inherit ui-first-child ui-last-child").end().find("a").removeClass("ui-link").end(),this._origDom=s),!this._created){var p=this._wrapCollapsible();if(t={wrapper:p,header:p.find("h1"),button:p.find("h1 + a, h1 + button"),content:p.find("div.ui-collapsible-content")},"complex"===this.options.editableType){var u=t.content.find("li:first-child").find("[data-item-name]"),m=this._itemNames;e.each(u,function(t,i){m.push(e(i).data("item-name"))})}e.extend(this,{_ui:t}),t.header.addClass("ui-btn-icon-left"),h=this._evt=e._data(t.header.parent()[0],"events"),this._clickHandler=h.click[0].handler,this._attachEditEventButtons(),this._created=!0}this._editMode?(t=this._ui,i=s.clone(),n=i.find("li"),0===i.find("a").length?n.wrapInner("<a></a>").append('<a class="ui-editable-btn-del">Delete</a>'):n.append('<a class="ui-editable-btn-del">Delete</a>'),this.option("splitIcon","minus"),"complex"===l.editableType&&i.prepend(e("<li>"+t.form[0].innerHTML+"</li>")),"simple"===l.editableType&&i.prepend(c.listTextInput),r.remove(),a.append(i.find("li")),h.click[0].handler=e.noop):(h.click[0].handler=this._clickHandler,r.remove().end().append(s.clone().find("li"))),this._updateHeader()},_afterListviewRefresh:function(){this._attachDetachEventHandlers()},_init:function(){var e=this.element,t=this.options,i=this._ui;"complex"===this.options.editableType&&(i.form=e.closest(':jqmData(role="page")').find("#"+t.editableForm).detach())},_wrapCollapsible:function(){{var t=this.element,i=this.options;this._isListEmpty()}return t.wrap('<div data-role="collapsible"></div>'),t.parent().prepend(this._$markup.header(i)),t.parents(e.mobile.collapsible.initSelector).not(e.mobile.page.prototype.keepNativeSelector()).collapsible({expandedIcon:this.options.expandedIcon,collapsedIcon:this.options.collapsedIcon}),t.parent().parent()},_attachEditEventButtons:function(){this._isListEmpty()&&this._ui.header.off("click"),this._on(this.element.parent().parent().find(".ui-collapsible-heading a, .ui-collapsible-heading button"),{click:"_onEditButtonTapped"})},_onEditButtonTapped:function(e){var t=this._editMode=!this._editMode,i=this.element.parents(":jqmData(role='collapsible')");i.collapsible(t?"expand":"collapse"),this.refresh(),e.preventDefault(),e.stopPropagation(),t||this._triggerListChange(e)},_updateHeader:function(){var e=this._ui,t=this.options,i=this._isListEmpty();e.header.text(i?t.listEmptyTitle:t.listTitle),e.button.removeClass("ui-icon-minus ui-icon-"+t.doneIcon+" ui-icon-"+t.addIcon+" ui-icon-"+t.editIcon).addClass("ui-icon-"+(this._editMode?t.doneIcon:i?t.addIcon:t.editIcon)).text(this._editMode?t.doneLabel:i?t.addLabel:t.editLabel)},_triggerListChange:function(e){var t=this.items(),i=this.length();this._trigger("change",e,{items:t,length:i})},_attachDetachEventHandlers:function(){this._enableInsertListItemEvent(),this._enableListItemDeleteEvent()},_enableInsertListItemEvent:function(){var e,t,i,n=this.options,a=n.editableType,l=this._ui.content;this._editMode&&(e=l.find("simple"===a?"li.ui-editable-temp a#item-add":"li:first-child [data-add-button='true']"),t="complex"===a?l.find("li:first-child [data-clear-button='true']"):null,i="simple"===a?l.find("input[type=text]"):null,this._on(e,{tap:"_insertListItem"}),null!==t&&this._on(t,{tap:"_clearTextFields"}),null!==i&&this._on(i,{keyup:"_insertListItem"}))},_clearTextFields:function(t){var i=e(t.target).parents("li").find("[data-item-name]");e.each(i,function(t,i){e(i).val("")})},_enableListItemDeleteEvent:function(){this._editMode?this._on(this._ui.content.find("a.ui-editable-btn-del"),{click:"_deleteListItem"}):this._off(this._ui.content.find("a.ui-editable-btn-del"),"click")},_insertListItem:function(t){if(t.preventDefault(),"tap"===t.type||t.keyCode===e.mobile.keyCode.ENTER){if("complex"===this.options.editableType){var i="",n=!0,a=e(t.target).parents("li").find("[data-item-name]");if(e.each(a,function(t,a){var l=e(a),s=l.data("item-element"),o=l.val();console.log(l),o||(n=!1),i+="<"+s+">"+o+"</"+s+">"}),!n)return;i=e("<li><a>"+i+"</a></li>"),i.attr("data-"+this._dataItemName,this._counter),this._counter++,this._origDom.prepend(i),this.refresh()}if("simple"===this.options.editableType){var l=e(t.target),s="keyup"===t.type?l:l.prev().find("input"),o=s.val();if(o){s.val("");var i=this._isListEmpty()?e("<li></li>"):this._origDom.find("li").first().clone();i.attr("data-"+this._dataItemName,this._counter),this._counter++,0===i.children().length?i.text(o):i.children("a").text(o),this._origDom.prepend(i),this.refresh()}}}},_deleteListItem:function(t){var i=e(t.currentTarget).parent(),n=i.data(this._dataItemName);this._origDom.find("li[data-"+this._dataItemName+'="'+n+'"]').remove(),i.remove(),this._updateHeader(),t.preventDefault(),t.stopPropagation()},_isListEmpty:function(){return 0===this.element.find("li").not("li.ui-editable-temp").length?!0:!1},_$markup:{listTextInput:"<li class='ui-editable-temp ui-btn' style='padding: 0.3em 0.8em;'><div class='ui-editable-flex'><div style='background-color: white; padding: 0;' class='ui-editable-flex-item-left ui-editable-border-left ui-input-text ui-btn ui-shadow-inset'><input type='text'></div><a id='item-add' style='height: auto' class='ui-editable-flex-item-right ui-editable-border-right ui-btn ui-shadow ui-btn-icon-notext ui-icon-plus'>Add</a></div></li>",header:function(e){return"<div data-role='header'><h1>List Items</h1><button class='ui-btn ui-mini ui-btn-inline ui-btn-right ui-btn-icon-right ui-icon-edit ui-btn-"+e.buttonTheme+" "+(e.buttonCorner?"ui-corner-all ":"")+(e.buttonShadow?"ui-shadow ":"")+"'>Edit</button></div>"}},length:function(){return this.element.find("li").length},items:function(){var t=[],i=this._itemNames;return"simple"===this.options.editableType&&this.element.find("li").each(function(e,i){t.push(i.textContent)}),"complex"===this.options.editableType&&this.element.find("a").each(function(n,a){var l={};e(a).children().each(function(t,n){l[i[t]]=e(n).text()}),t.push(l)}),t},widget:function(){return this._ui.wrapper}})}(jQuery),function(e){"use strict";e.widget("mobile.collapsible",e.mobile.collapsible,{options:{heading:"h1,h2,h3,h4,h5,h6,legend,:jqmData(role='header')"},_create:function(){var t=this.element,i={accordion:t.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')"+(e.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=i,this._renderedOptions=this._getOptions(this.options),e.each(this._childWidgets,e.proxy(function(t,i){e.mobile[i]&&this.element.find(e.mobile[i].initSelector).not(e.mobile.page.prototype.keepNativeSelector())[i]()},this)),this.options.enhanced?(i.heading=e(".ui-collapsible-heading",this.element[0]),i.content=i.heading.next(),i.anchor=e("a",i.heading[0]).first(),i.status=i.anchor.children(".ui-collapsible-heading-status")):this._enhance(t,i),this._on(i.heading,{tap:function(){i.heading.find("a").first().addClass(e.mobile.activeBtnClass)},click:function(t){var n=e(t.target);(n.hasClass("ui-collapsible-heading")||n.hasClass("ui-collapsible-heading-toggle"))&&this._handleExpandCollapse(!i.heading.hasClass("ui-collapsible-heading-collapsed")),t.preventDefault(),t.stopPropagation()}})},_childWidgets:["toolbar"],_enhance:function(t,i){var n,a=this._renderedOptions,l=this._themeClassFromOption("ui-body-",a.contentTheme);return t.addClass("ui-collapsible "+(a.inset?"ui-collapsible-inset ":"")+(a.inset&&a.corners?"ui-corner-all ":"")+(l?"ui-collapsible-themed-content ":"")),i.originalHeading=t.children(this.options.heading).first(),i.content=t.wrapInner("<div class='ui-collapsible-content "+l+"'></div>").children(".ui-collapsible-content"),i.heading=i.originalHeading,i.heading.is("legend")&&(i.heading=e("<div role='heading'>"+i.heading.html()+"</div>"),i.placeholder=e("<div><!-- placeholder for legend --></div>").insertBefore(i.originalHeading),i.originalHeading.remove()),n=a.collapsed?a.collapsedIcon?"ui-icon-"+a.collapsedIcon:"":a.expandedIcon?"ui-icon-"+a.expandedIcon:"",i.status=e("<span class='ui-collapsible-heading-status'></span>"),i.anchor=i.heading.detach().addClass("ui-collapsible-heading").append(i.status).wrapInner(i.heading.is(":jqmData(role='header')")?"":"<a href='#'></a>").find(i.heading.is(":jqmData(role='header')")?"h1,h2,h3,h4,h5,h6":"a").first().addClass("ui-collapsible-heading-toggle"+(i.heading.is(":jqmData(role='header')")?"":" ui-btn "+(n?n+" ":"")+(n?iconposClass(a.iconpos)+" ":"")+this._themeClassFromOption("ui-btn-",a.theme)+" "+(a.mini?"ui-mini ":""))),i.heading.insertBefore(i.content),this._handleExpandCollapse(this.options.collapsed),i},_handleExpandCollapse:function(t){var i=this._renderedOptions,n=this._ui;n.status.text(t?i.expandCueText:i.collapseCueText),n.heading.toggleClass("ui-collapsible-heading-collapsed",t).find(".ui-collapsible-heading-toggle").toggleClass("ui-icon-"+i.expandedIcon,!t).toggleClass("ui-icon-"+i.collapsedIcon,t||i.expandedIcon===i.collapsedIcon).removeClass(e.mobile.activeBtnClass),this.element.toggleClass("ui-collapsible-collapsed",t),n.content.toggleClass("ui-collapsible-content-collapsed",t).attr("aria-hidden",t).trigger("updatelayout"),this.options.collapsed=t,this._trigger(t?"collapse":"expand")}})}(jQuery);